<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="stylesheet" href="./css/config.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="shortcut icon" href="./assets/favicon-16x16.png" type="image/x-icon">
    <script src="./js/funcoes.js"></script>
    <title>Descubra sua configuração</title>
</head>

<body id="background">
    <div class="background">
        <div class="navbar">
            <ul>
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
                <li class="lista">
                    <a href="dashboard-Home.html">
                        <span class="icone"><img src="./assets/home.png" alt="" width="40px"
                                height="40px"></span></span>
                        <span class="label">PÁGINA INICIAL</span>
                    </a>
                </li>
                <li class="lista ativo">
                    <a href="config.html">
                        <span class="icone"><img src="./assets/config.png" alt="" width="40px"
                                height="40px"></span></span>
                        <span class="label">DESCUBRA SUA CONFIG</span>
                    </a>
                </li>
                <li class="lista">
                    <a href="vote.html">
                        <span class="icone"><img src="./assets/vote.png" alt="" width="40px" height="40px"></span>
                        <span class="label">VOTE AGORA</span>
                    </a>
                </li>
                <li class="lista ">
                    <a href="dashboard.html">
                        <span class="icone"><img src="./assets/estatistica.png" alt="" width="40px"
                                height="40px"></span>
                        <span class="label">ESTATÍSTICAS</span>
                    </a>
                </li>
                <li class="lista ">
                    <a href="mural.html">
                        <span class="icone"><img src="./assets/feedback.png" alt="" width="40px" height="40px"></span>
                        <span class="label">AVALIAÇÃO DO USUÁRIO</span>
                    </a>
                </li>
                <li class="lista" id="last">
                    <a href="index.html" onclick="logout()">
                        <span class="icone"><img src="./assets/logout.png" alt="" width="40px" height="40px"></span>
                        <span class="label">SAIR</span>
                    </a>
                </li>
            </ul>

        </div>

        <div class="imagem" id="imagem">
            <div class="container1">
                <div class="conteudo">
                    <h2>DESCUBRA A SUA <b> CONFIGURAÇÃO</b></h2>
                    <p>Selecione <b>3 jogos </b>que mais se assemelham aos jogos que você pretende jogar e depois clique
                        no botao
                        <b>ver resultado</b> e confira a config <b>perfeita para você!</b> Mas <b>atenção!</b> As
                        configs geradas foram montadas para rodar os jogos na resolução <b>1920x1080</b> com gráficos
                        setados para o <b>máximo</b> possível!
                    </p>

                    <div class="caixaformulario">
                        <div class="caixa">
                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem1">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>TERRARIA</h1>
                                            <p>Sandbox em plataforma 2D</p>
                                            <p>Configuração: <i>Muito baixa</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao0" value="0">
                                    <span class="selecionado"></span>
                                </label>
                            </div>

                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem2">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>CS:GO</h1>
                                            <p>FPS Competitivo</p>
                                            <p>Configuração: <i>Baixa</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao1" value="1">
                                    <span class="selecionado"></span>
                                </label>
                            </div>

                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem3">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>PUBG</h1>
                                            <p>Battle Royale</p>
                                            <p>Configuração: <i>Média para baixa</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao2" value="2">
                                    <span class="selecionado"></span>
                                </label>
                            </div>
                        </div>
                        <div class="caixa">
                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem4">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>Call of Duty - MW2</h1>
                                            <p>FPS</p>
                                            <p>Configuração: <i>Média para alta</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao3" value="3">
                                    <span class="selecionado"></span>
                                </label>
                            </div>

                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem5">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>God of War - 2018(PC)</h1>
                                            <p>Hack'n slash / RPG</p>
                                            <p>Configuração: <i>Alta</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao4" value="4">
                                    <span class="selecionado"></span>
                                </label>
                            </div>

                            <div class="carta">
                                <label class="main">
                                    <div class="carta-giratoria">
                                        <div class="carta-frente imagem6">

                                        </div>
                                        <div class="carta-tras">
                                            <h1>Red Dead Redemption 2</h1>
                                            <p>Ação-aventura / Mundo aberto</p>
                                            <p>Configuração: <i>Muito alta</i></p>
                                        </div>
                                    </div>
                                    <input type="checkbox" id="caixaSelecao5" value="5">
                                    <span class="selecionado"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <button class="botao" onclick="resultado()">Ver resultado</button>
                </div>
            </div>

        </div>

    </div>

</body>

</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    function logout() {
        limparSessao()
    }

    var posicao = 0
    var selecionados = []

    var config = [
        {
            processador: "1x AMD - Ryzen 3 2200g (3.7GHz Turbo)",
            placa_mae: "1x Gigabyte GA-A320M-H",
            memoria_ram: "1x Husky Gaming, 8GB, 2400MHz, DDR4",
            memoria_interna: "1x SSD 120 GB Kingston A400",
            placa_de_video: "1x Vega 8 - Integrada do processador",
            fonte: "1x Blue Case 200W, 80 Plus White",
            fkConfig: 1
        },

        {
            processador: "1x AMD - Ryzen 5 2400g (3.9GHz Turbo)",
            placa_mae: "1x Gigabyte B-350m",
            memoria_ram: "1x Husky Gaming, 8GB, 2400Mhz, DDR4",
            memoria_interna: "1x SSD 120 GB Kingston A400",
            placa_de_video: "1x RX 560 PowerColor Red Dragon ou Vega 11 - Integrada do processador",
            fonte: "1x Gamemax GM500 500W, 80 Plus Bronze, PFC Ativo",
            fkConfig: 2
        },

        {
            processador: "1x Intel Core - I5 10400f (4.3Ghz Turbo)",
            placa_mae: "1x Asus Prime H410M-E",
            memoria_ram: "2x Husky Gaming - 8GB DDR4 2666MHz",
            memoria_interna: "1x SSD 240 GB Kingston A400",
            placa_de_video: "1x RX 570 PowerColor Red Dragon",
            fonte: "1x Gamemax GM400 400W, 80 Plus White",
            fkConfig: 3
        },

        {
            processador: "1x Intel Core - I5 10600KF (4.8Ghz Turbo)",
            placa_mae: "1x Asus TUF Gaming B450M",
            memoria_ram: "2x HyperX Fury - 8GB DDR4 2666MHz",
            memoria_interna: "1x SSD 240 GB Gigabyte",
            placa_de_video: "1x Galax GeForce GTX 1060 Super 6GB 1-CLICK OC",
            fonte: "1x Gamemax GM500 500W, 80 Plus Bronze, PFC Ativo",
            fkConfig: 4
        },

        {
            processador: "1x AMD - Ryzen 7 5700X (4.6Ghz Turbo)",
            placa_mae: "1x Gigabyte B550M Aorus Elite",
            memoria_ram: "2x 8GB 3200MHz, DDR4 Kingston Fury Beast RGB",
            memoria_interna: "1x SSD NVME 512GB WD GREEN",
            placa_de_video: "1x RTX 2060 1-Click OC Galax 6gb",
            fonte: "1x Fonte Corsair 650W, 80 Plus Bronze",
            fkConfig: 5
        },

        {
            processador: "1x Intel Core - I9 10900k (5.3Ghz Turbo)",
            placa_mae: "1x Asus Rog Strix Z490-G Gaming",
            memoria_ram: "4x 8GB 3200MHz, DDR4 Kingston Fury Beast RGB",
            memoria_interna: "1x SSD 1 TB WD Black",
            placa_de_video: "1x RTX 3070 TI 1-Click OC Galax 8gb",
            fonte: "1x Corsair 700W, 80 Plus Gold",
            fkConfig: 6
        }
    ]

    function resultado() {
        selecionados.splice(0, selecionados.length);

        if (caixaSelecao0.checked == true) {
            selecionados.push(caixaSelecao0.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }
        if (caixaSelecao1.checked == true) {
            selecionados.push(caixaSelecao1.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }
        if (caixaSelecao2.checked == true) {
            selecionados.push(caixaSelecao2.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }
        if (caixaSelecao3.checked == true) {
            selecionados.push(caixaSelecao3.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }
        if (caixaSelecao4.checked == true) {
            selecionados.push(caixaSelecao4.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }
        if (caixaSelecao5.checked == true) {
            selecionados.push(caixaSelecao5.value)

            console.log(`Existem ${selecionados.length} jogo(s) no vetor`)
        }

        if (selecionados.length == 0) {
            alert(`Você precisa selecionar pelo menos 1 jogo para prosseguir!`)
            window.location = "config.html"
        } else if (selecionados.length > 3) {
            alert(`Você pode selecionar no máximo 3 jogos!`)
            window.location = "config.html"
        } else if (selecionados.length > 0 && selecionados.length <= 3) {
            selecionar_config()
        }

        console.log(selecionados)
        console.log(`No final, ficaram apenas ${selecionados.length} jogo(s) no vetor`)

    }

    function selecionar_config() {
        for (var index = 0; index < config.length; index++) {
            var configAtual = config[index];
            if (index == Number(selecionados[selecionados.length - 1])) {
                console.log(configAtual)
                posicao = index
            }
        }

        var resultado = document.getElementById("imagem")
        resultado.innerHTML = ``

        resultado.innerHTML = `
        <div class="social2" id="social2">
          <div class="container1">
                <div class="conteudo">
                    <h2>SUA CONFIGURAÇÃO <b> PERFEITA É...</b></h2>
                    <div class="texto">
                        <p><b>Processador:</b> ${config[posicao].processador} <br> </p>
                        <p><b>Placa-mãe:</b> ${config[posicao].placa_mae} <br> </p>
                        <p><b>Memoria ram:</b> ${config[posicao].memoria_ram} <br> </p>
                        <p><b>Memória interna:</b> ${config[posicao].memoria_interna} <br> </p>
                        <p><b>Placa de vídeo:</b> ${config[posicao].placa_de_video} <br> </p>
                        <p><b>Fonte:</b> ${config[posicao].fonte} <br> </p>
                    </div>
                    <button class="botao" onclick="voltar()">Voltar</button>
                    <button class="botao" onclick="gravar()">Gravar minha config</button>
                    <div class="alerta_erro">
                            <div class="card_erro" id="cardErro">
                                <span id="mensagem_erro"></span>
                            </div>
                        </div>
                        <div id="div_aguardar" class="loading-div">
                        </div>

                        <div id="div_erros_login">

                        </div>
                </div>
            </div>
        </div>
    </div>`
    }

    function voltar() {

        window.location = "config.html"
    }

    function gravar() {
        aguardar();

        var idUsuario = sessionStorage.getItem("ID_USUARIO");

        // Enviando o valor da nova input
        fetch("/usuarios/gravarConfig", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkConfig: config[posicao].fkConfig,
                idUsuario,
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Sua Config foi salva no banco de dados! Ela aparecerá na página <span id="s1">estatísticas</span>!`;

                sessionStorage.FK_CONFIG = config[posicao].fkConfig,
                    carregarConfig()

                setTimeout(() => {
                    window.location = "dashboard.html"
                }, "3000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao gerar sua config!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function carregarConfig() {
        var idConfig = sessionStorage.FK_CONFIG

        fetch(`/usuarios/carregarConfig/${idConfig}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    console.log(resposta[0].processador)

                    sessionStorage.PROCESSADOR = resposta[0].processador
                    sessionStorage.PLACA_MAE = resposta[0].placaMae
                    sessionStorage.MEMORIA_RAM = resposta[0].memoriaRam
                    sessionStorage.MEMORIA_INTERNA = resposta[0].memoriaInterna
                    sessionStorage.PLACA_DE_VIDEO = resposta[0].placadeVideo
                    sessionStorage.FONTE = resposta[0].fonte

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

</script>